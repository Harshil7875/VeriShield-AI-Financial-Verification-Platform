# **Notebook: `01-EDA-4.ipynb`**

## **Overview**

This notebook conducts an **advanced exploratory data analysis** (EDA) on **synthetic VeriShield data** generated by the refined data generator. It provides **deep dives** into user attributes, business attributes, and the relationships (user–user, user–business) that introduce ring leaders and multi-owner patterns. By inspecting distributions and correlations, you can confirm whether the multi-pass labeling and suspicious signals are reflected in the dataset as intended.

**Key Objectives**:

1. **Load & Validate** the scenario-specific CSVs (e.g., `high_fraud`).  
2. **Analyze** user-level features (fraud labels, segments, IP collisions, ring leaders).  
3. **Explore** business attributes (suspicious names, registration countries, fraud rates).  
4. **Inspect** ownership patterns (user–business edges) and ring-leader relationships (user–user edges).  
5. **Identify** common suspicious signals (shared IPs, email domains, multi-owner businesses).  

## **Usage & Setup**

1. **Prerequisites**:  
   - Ensure you’ve run the **`refined_data_generator.py`** script, generating CSVs in the correct **scenario** subfolder (e.g., `data_generators/data/high_fraud`).  
   - Adjust the `SCENARIO` and `DATA_DIR` variables to point to your **actual** directory paths.

2. **Launching the Notebook**:  
   - Via Jupyter Lab or Jupyter Notebook, open `01-EDA-4.ipynb` in the `notebooks/EDA/` folder.  
   - Confirm the paths in **Cell 2** match where you stored the CSV outputs.  

3. **Running the Cells**:  
   - Execute the cells in order; each cell prints summaries, tables, and distributions.  
   - Some cells skip ring-leader analysis if `user_user_relationships.csv` or `is_ring_leader` columns aren’t present.

## **Notebook Structure**

1. **Cell 1: Imports & Global Settings**  
   - Imports `pandas`, sets up display options for columns/rows.

2. **Cell 2: Configuration**  
   - **`SCENARIO`**: which dataset folder to load (e.g., `default`, `low_fraud`, `high_fraud`).  
   - **`DATA_DIR`**: base path where `synthetic_users.csv`, `synthetic_businesses.csv`, etc., reside.

3. **Cell 3: Load CSVs**  
   - Reads user, business, and user–business CSVs.  
   - Tries to load `user_user_relationships.csv` for ring-leader edges.  
   - Prints shapes and basic info.

4. **Cell 3.1: User–User Relationship Analysis** *(Optional)*  
   - If ring leaders exist, inspects how many distinct “from_user_id” vs. “to_user_id” appear.  
   - Checks for an `is_ring_leader` column in `df_users`.

5. **Cell 4: User EDA**  
   - **`df_users.info()`**, `.describe()`, missing values check, distribution of `fraud_label` and `segment`.  
   - Looks for ring_leader distribution, country codes, IP usage, suspicious email domains, etc.  
   - Derives statistics around IP collisions (`signup_ip`) or device collisions (`device_id`).

6. **Cell 5: Groupings & Cross-Tabs**  
   - Groups by `(fraud_label, country_code)` or `(is_ring_leader, fraud_label)`.  
   - Further checks IP collisions by fraud status.

7. **Cell 6: Business EDA**  
   - Similar approach for **`df_businesses`**: `.info()`, `.describe()`, missing values, `fraud_label` distribution.  
   - Registration country frequencies, suspicious owner names, etc.

8. **Cell 7–8: User–Business Relationships**  
   - **`df_relationships`**: who owns which businesses, shape and outliers.  
   - Summarizes # of businesses per user, # of owners per business.  
   - Merges user + business fraud labels to see potential overlap or correlation.  

9. **Cell 9: Ring-Leader Out-Degree** *(If user_user edges exist)*  
   - Groups ring leaders by how many “to_user_id” connections they have.  
   - Cross-checks ring_leader with fraud labels.  

10. **Conclusion**  
   - Prints final statements and ends the analysis.

## **Key Insights & Checks**

1. **Fraud Distribution**  
   - Validates how many users/businesses are labeled fraudulent in the chosen scenario (e.g., `high_fraud` might show 30% user fraud and ~98% business fraud).

2. **Ring Leaders**  
   - Ensures only a small fraction (e.g., 0.5%) are ring leaders but each with multiple edges to other users.

3. **Multi-Ownership**  
   - Checks if some businesses have a large number of owners or vice versa, indicating potential collusion.

4. **Suspicious Signals**  
   - IP collisions, device collisions, suspicious email domains, or phone prefixes. The notebook reveals how widespread these patterns are.

## **Benefits**

- **Validation**: Ensures the **refined_data_generator.py** is producing consistent outputs.  
- **Feature Engineering Ideas**: Observing IP collisions or ring-leader clusters might inspire additional or refined features for ML or GNN models.  
- **Scenario Comparison**: By changing `SCENARIO`, you can quickly compare distributions for `low_fraud` vs. `high_fraud`.

## **Tips for Further Exploration**

- **Visualization**: You could add seaborn or matplotlib plots (histograms, bar charts) to visualize distributions more intuitively.  
- **Time-Based Analysis**: If you want to see sign-up patterns over days, parse `created_at` into a datetime and group by day or hour.  
- **Export**: You can export partial results or stats to a CSV or JSON if you want an external summary of EDA findings.